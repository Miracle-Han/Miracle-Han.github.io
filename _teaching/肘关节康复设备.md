---
title: "基于sEMG的肘关节康复设备"
collection: teaching
type: "Research"
permalink: /projects/基于sEMG的肘关节康复设备
venue: "Fuzhou University, Research Center of Joint Intelligent Medical Engineering"
date: 2023-02-01
location: "Fuzhou, China"
---
<br>

# 背景介绍
表面肌电图(sEMG)是一种生理肌电信号，在康复医学中可用于控制智能假肢和仿生手。它还包含肌肉力量和关节运动角度等信息，可用于评估肢体运动状态。本项目研究肘部弯曲时上臂肌电信号与弯曲角度的关系。通过简单的时频分析，建立了上臂表面肌电信号与肘关节弯曲角度的非线性相关关系。同时采用四种滤波器(Butterworth、Chebyshev I、Chebyshev II、椭圆滤波器)设计IIR滤波器，通过全波整流和二次采样得到稳定的表面肌电信号和采样频率一致的角度数据。随后，利用BP神经网络建立表面肌电信号与角度的预测模型，实现基于表面肌电信号的角度预测;最后，建立了肘部康复设备的机械结构模型，并利用预测模型作为控制器对其进行自主控制。
<br/><img src='/images/Project/BPnetwork/SystemBlockDia.jpg'>

<br>

# 研究内容
## 1. 数据采集及时频分析
在本项目中，分别使用gForcePro+表面肌电信号采集臂环[1]和BWT901CL姿态传感器[2]采集上臂表面肌电信号和肘关节屈曲角度数据。肌电仪上有4组8个电极，可分别采集肱二头肌和肱三头肌4个通道的肌电信号。在实验中，肌电仪佩戴在上臂，姿态传感器固定在肘部。当测试仪进行肘关节屈伸时，通过上位机将两组电极的差分信号和姿态传感器测得的肘关节角度信号同时记录在计算机中，其中肌电信号的采样频率为1000Hz，角度采样频率为50Hz。
<br/><img src='/images/Project/BPnetwork/1.jpg'>

通过读取采集到的数据集，分别在时域和频域对数据进行分析。

**时域分析：** 图4-7为原始表面肌电信号幅度的时变趋势。图8为角度变化与时间的关系。通过对获得的表面肌电信号和肘关节角度信号数据进行时域分析，可以看出表面肌电信号通道2和表面肌电信号通道4的变化趋势与角度变化趋势相关。
<br/><img src='/images/Project/BPnetwork/2.png'>

**频域分析：** 图9-12为经FFT变换后的表面肌电信号频谱。从4通道的表面肌电信号频谱窗口可以看出，信号的频率大多集中在0-250Hz范围内，这表明可以使用低通滤波器进行滤波，去除高频噪声。
<br/><img src='/images/Project/BPnetwork/3.jpg'>
<br/><img src='/images/Project/BPnetwork/4.jpg'>

<br>

## 2. 信号处理
IIR (Infinite Impulse Response Filter) 滤波器是一种无限脉冲响应滤波器，也称为递归滤波器，它有一个反馈回路。由于IIR数字滤波器可以使用成熟的模拟滤波器的结果，如巴特沃斯滤波器、切比雪夫滤波器和椭圆滤波器等，有现成的设计数据或图表可以检查，设计工作量相对较小，对计算工具的要求也不高。因此，本项目选择使用IIR过滤器。通过对IIR滤波器去噪后的表面肌电信号数据进行全波整流和二次采样，得到更稳定的表面肌电信号(n)，保证了表面肌电信号与关节角信号采样频率的一致性。

<!-- 通带（Passband）是指滤波器允许信号通过的频率范围。在这个范围内，信号的幅度衰减很小，因此被认为是被“通过”的频率成分。通带的具体特性和定义可能会因滤波器类型和设计而有所不同，但通常具有以下特征：

特性
    低衰减：在通带内，信号的幅度衰减最小。对于理想滤波器，通带内的频率成分不应有任何衰减。

    平坦响应：在通带内，理想情况下，滤波器的频率响应应尽可能平坦，没有波纹或起伏。这确保了通带内的所有频率成分被均匀放大或衰减。

    定义：通带的上限频率和下限频率分别定义了通带的边界。对于低通滤波器，通带是从0到截止频率；对于高通滤波器，通带是从截止频率到无限；对于带通滤波器，通带是两个截止频率之间的频率范围。 -->

**2.1 Butterworth filter 巴特沃斯滤波器:**
巴特沃斯滤波器（Butterworth filter）是一种具有平滑频率响应的滤波器。
- **平坦响应:** 在通带内，巴特沃斯滤波器的幅频响应是最平坦的，没有波纹。这意味着它在通带内不会放大或削弱特定频率的信号。
- **单调衰减:** 在截止频率之外，巴特沃斯滤波器的响应单调下降，不会出现波纹。这种特性使得它在某些应用中非常有用，因为它避免了其他滤波器可能带来的伪影。

模拟巴特沃斯滤波器的传递函数为：

**$$H(s) = \frac{1}{\sqrt{1 + \left( \frac{s}{\omega_c} \right)^{2n}}}$$**

- H(s) 是滤波器的传递函数。
- s 是复数频率变量。
- ω 是滤波器的截止角频率。
- n 是滤波器的阶数。

**图15是巴特沃斯滤波器效果**
<br/><img src='/images/Project/BPnetwork/5.jpg'>

**2.2 Chebyshev filter 切比雪夫滤波器:**
切比雪夫滤波器在过渡带的衰减速度比巴特沃斯滤波器快，但频率响应的幅频特性没有巴特沃斯滤波器平坦。切比雪夫滤波器的频率响应曲线与理想滤波器的误差最小，但通带内存在幅度波动。根据频率响应曲线的波动位置，切比雪夫滤波器可分为两种:

**切比雪夫I型滤波器**
- **通带内有波纹:** 通带内的频率响应具有等波纹（等波纹的幅度在整个通带内是均匀的）。
- **更陡的滚降:** 相对于同阶的巴特沃斯滤波器，切比雪夫I型滤波器在截止频率附近的衰减更快。

切比雪夫I型滤波器的传递函数为：

**$$H(s) = \frac{1}{\sqrt{1 + \epsilon^2 T_n^2 \left( \frac{s}{j \omega_c} \right)}}$$**

- ϵ 是波纹因子，决定了通带内的波纹大小。
- $$T_n^2$$ 是切比雪夫多项式。
- n 是滤波器的阶数。

**图16是切比雪夫I型滤波器效果**
<br/><img src='/images/Project/BPnetwork/6.jpg'>

**切比雪夫II型滤波器**
- **阻带内有波纹:** 阻带内的频率响应具有等波纹（等波纹的幅度在整个阻带内是均匀的）。
- **无通带波纹:** 通带内没有波纹，因此在通带内频率响应是平坦的。
- **更陡的滚降:** 在阻带开始时有更陡的衰减，但相对于切比雪夫I型滤波器，通带内的响应更加平坦。

切比雪夫II型滤波器的传递函数为

**$$H(s) = \frac{1}{\sqrt{1 + \frac{1}{\epsilon^2 T_n^2 (j \omega_c s)}}}$$**

- ϵ 是波纹因子，决定了阻带内的波纹大小。
- $$T_n$$ 是切比雪夫多项式。
- n 是滤波器的阶数。

**切比雪夫多项式**
切比雪夫多项式 $$T_n(x)$$ 是切比雪夫滤波器设计中的一个关键组件，定义为：
**$$T_n(x) = \cos \left( n \cdot \cos^{-1}(x) \right)$$**
切比雪夫多项式在 −1≤ x ≤1 范围内是正交的，并在这些范围内具有波纹的特性。

<br>

#  3. 肘关节角度预测模型
本项目的最终目标是使用肌电图来预测肘关节的屈曲角度。因为在康复训练中患者经常会做一些连续的康复动作。只有准确预测角度，才能利用表面肌电信号对外骨骼机器人进行控制，才能真正应用于康复训练。在完成上一步采集到的表面肌电信号的去噪和整流后，需要在处理后的表面肌电信号与角度之间建立预测模型。由于表面肌电信号数据与肘关节屈曲角之间的关系无法用一定的数学模型表示，考虑到神经网络强大的智能处理特性和对噪声的不敏感，本项目选择BP神经网络建立表面肌电信号与肘关节屈曲角之间的模型关系。

## 3.1 BP Neural Network
BP神经网络（Backpropagation Neural Network，反向传播神经网络）是一种多层前馈神经网络，通过反向传播算法来训练网络中的权重和偏置。BP神经网络模型拓扑包括输入层、隐藏层和输出层。
- **输入层:** 接受输入数据，每个节点对应一个输入特征。
- **隐藏层:** 一或多个隐藏层，每个节点通过激活函数处理输入层或前一层的输出。
- **输出层:** 产生网络的最终输出，每个节点对应一个输出值。

在**前向传播**过程中，数据从输入层通过隐藏层传递到输出层。**反向传播**通过最小化损失函数来调整网络中的权重和偏置。


隐藏层(layer)中的神经元数量是不断试错的。隐层和输出层的传递函数分别为tansing和purelin。，网络训练函数为'trainrp'，其他参数采用MATLAB默认。对于隐层单元数的确定，目前没有准确的方法，是基于以下经验公式，不断试错。具体算法流程如下:
<br/><img src='/images/Project/BPnetwork/BPNetwork.jpg'>

## 3.2 角度预测试验及结果分析
在完成表面肌电信号数据集的处理和BP神经网络的构建后，使用MATLAB2021b对模型进行训练并测试角度预测性能。训练结果和预测结果如图22-23所示。需要注意的是，由于表面肌电信号数据中通道2和4的幅度变化趋势与角度变化趋势更为相似，所以训练模型只使用这两个通道数据。
<br/><img src='/images/Project/BPnetwork/7.jpg'>

<br>

# 4. 肘部康复器材的结构设计
由于本项目希望最终能应用于实践，所以将肘关节弯曲角度预测模型作为肘关节康复设备的控制器。因此本项目还对肘部康复设备的机械结构等硬件设施进行了研究，肘部康复设备控制逻辑如图24所示，肘部康复设备结构如图25所示。
<br/><img src='/images/Project/BPnetwork/8.jpg'>
